<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title layout:title-pattern="$DECORATOR_TITLE $CONTENT_TITLE">OKIDAK</title>
</head>
    <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
            folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="/css/_all-skins.min.css">
    <link rel="stylesheet" href="/css/datepicker3.css">
    <!-- Theme style -->
    <!-- iCheck -->
    <link rel="stylesheet" href="/css/blue.css">
    <!-- Morris chart -->
    <link rel="stylesheet" href="/css/morris.css">
    <!-- bootstrap wysihtml5 - text editor -->
    <link rel="stylesheet" href="/css/bootstrap3-wysihtml5.min.css">
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
        <![endif]-->

<body>

<div class="wrapper">

    <header class="main-header">
        <div th:replace="~{/fragments/header}"></div>
    </header>
    <!-- Left side column. contains the logo and sidebar -->
    <aside class="main-sidebar">

        <div th:replace="~{/fragments/mainsidebar}"></div>
    </aside>


    

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <div layout:fragment="content">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <h1>
                    List of Campaigns
                </h1>
            </section>
    
            <section class="content">
                
                <div class="col-md-12" style="margin-top: 10px; align-content: center; font-weight: bold;">
                        <div class="row info-box-content" style="display: flex;">
                            <span class="col-md-2">Name</span>
                            <span class="col-md-2">Status</span>
                            <span class="col-md-3">Date debut et date fin</span>
                        </div>
                </div>

                <br>

                <div class="col-md-12" th:each="campaign : ${campaigns}" style="margin-top: 10px; align-content: center;">
                    <div class="info-box">
                        <span class="info-box-icon bg-info"><i class="fa fa-video-camera"></i></span>
                        <div class="row info-box-content" style="display: flex;">
                            <span class="info-box-text col-md-2" style="text-transform: none;" th:text="${campaign.name}"></span>
                            <span class="info-box-number col-md-2" th:text="${campaign.status}"></span>
                            <span class="info-box-text col-md-2" style="text-transform: none;" th:text="${#temporals.format(campaign.date_debut, 'dd/MM/yyyy HH:mm')} + ' - ' + ${#temporals.format(campaign.date_fin, 'dd/MM/yyyy HH:mm')}"></span>
                            <span class="info-box-text col-md-2" style="text-transform: none;" > <a th:href="@{/liste_campaign_periode(id_campaign=${campaign.id})}" class="btn btn-primary">Voir les periodes</a> </span>
                            <span class="info-box-text col-md-2" style="text-transform: none;" > 
                                <button class="btn btn-primary" onclick="openDialog(this)" 
                                    th:data-name="${campaign.name}"
                                    th:data-url_video="${campaign.campaign_video.urlVideo}" 
                                    >
                                    Afficher la fenêtre
                                </button> 
                            </span>
                            <span class="info-box-text col-md-2" style="text-transform: none;" > 
                                <button type="button" class="btn btn-primary" th:data-url_video="${campaign.campaign_video.urlVideo}" data-toggle="modal" data-target="#exampleModalCenter">
                                    Launch demo modal
                                  </button>
                            </span>
                        </div>
                    </div>
                </div>

                <dialog id="myDialog">
                    <h2 id="dialogName"></h2>
                    <iframe width="560" height="315"
                            id="dialogIframe"
                            frameborder="0"
                            allowfullscreen>
                    </iframe>
                    <button id="closeDialog" onclick="closeDialog()">Fermer</button>
                </dialog>

                <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content" style="width: 640px;">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title" id="exampleModalCenterTitle">Video Modal</h4>
                            </div>
                            <div class="modal-body" style="position: relative;
                                                           height: 360px;
                                                           overflow: hidden;">
                                
                                <!-- Élément transparent couvrant l'iframe -->
                                <div id="cover" style="position: absolute;
                                                       top: 0;
                                                       left: 0;
                                                       width: 100%;
                                                       height: 100%;
                                                       z-index: 10;
                                                       background: transparent;
                                                       cursor: default;">
                                </div>
                                <!-- Conteneur de l'iframe -->
                                <div id="player-container" style="position: relative;
                                                                  width: 100%;
                                                                  height: 100%;">

                                    <div id="player" style="width: 100%;
                                                            height: 100%;
                                                            border: none;
                                                            display: block;">
                                    </div>

                                </div>
                                
                                
                            </div>
                            <div class="modal-footer">
                                <input type="range" id="progress-bar" value="0" min="0" max="100">
                                <span id="current-time">00:00</span> / <span id="duration">00:00</span>
                                <button id="playButton" class="btn btn-primary"></button> <!-- Custom play button -->
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                

            
                

            </section>
        <!-- /.content -->
        </div>
    <!-- 
    <footer class="main-footer">    
        <strong>Copyright &copy; 2018 SinghFactory</strong>
    </footer> -->
    </div>
    <!-- jQuery 2.2.3 -->
    <script src="/js/jquery-2.2.3.min.js"></script>
    <!-- Bootstrap 3.3.6 -->
    <script src="/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="/js/fastclick.js"></script>
    <!-- AdminLTE App -->
    <script src="/js/app.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="/js/demo.js"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="/js/jquery-ui.min.js"></script>
    <!-- Slimscroll -->
    <script src="/js/jquery.slimscroll.min.js"></script>


    <!-- Morris.js charts -->
    <script src="/js/raphael-min.js"></script>
    <script src="/js/morris.min.js"></script>
    <!-- Sparkline -->
    <script src="/js/jquery.sparkline.min.js"></script>
    <!-- jQuery Knob Chart -->
    <script src="/js/jquery.knob.js"></script>
    <!-- Bootstrap WYSIHTML5 -->
    <script src="/js/bootstrap3-wysihtml5.all.min.js"></script>

    <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
    <script src="/js/dashboard.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- <script src="https://www.youtube.com/iframe_api"></script> -->



    <script>

        function openDialog(button) {
            var dialog = document.getElementById('myDialog');
            var name = button.getAttribute('data-name');
            var url_video = button.getAttribute('data-url_video');

            var videoId = extractVideoId(url_video);
    
            document.getElementById('dialogName').innerText = name;
            document.getElementById('dialogIframe').src = 'https://www.youtube.com/embed/' + videoId;
    
            dialog.showModal();

        }

    
        function closeDialog() {
            var dialog = document.getElementById('myDialog');
            var iframe = document.getElementById('dialogIframe');
            iframe.src = ''; 
            dialog.close();
        }

        function extractVideoId(url) {
            if (url != null) {
                var start = "https://youtu.be/";
                var starts = "https://www.youtube.com/embed/";

                if (url.startsWith("https://youtu.be/")) {
                    return url.substring(start.length);
                }

                if (url.startsWith("https://www.youtube.com/watch?v=")) {
                    var videoId = url.split('v=')[1];
                    if (videoId.indexOf('&') !== -1) {
                        videoId = videoId.split('&')[0];
                    }
                    return videoId;
                }

                if (url.startsWith("https://www.youtube.com/embed/")) {
                    return url.substring(starts.length);
                }
            }

            return null;
        }



// -------------------------------


        // Charger l'API YouTube uniquement si elle n'est pas déjà chargée
        if (typeof YT === 'undefined' || typeof YT.Player === 'undefined') {
            var tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            tag.onload = function() {
                console.log("Script API YouTube chargé.");
            };
            tag.onerror = function() {
                console.error("Erreur lors du chargement du script API YouTube.");
            };
            var firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        } else {
            onYouTubeIframeAPIReady();
        }


            // Variable globale pour le lecteur
                var player;
                var playerReadyDeferred = $.Deferred();

                // Fonction appelée par l'API YouTube lorsqu'elle est prête
                function onYouTubeIframeAPIReady() {
                    console.log("API YouTube est prête");
                }

                // Écouteur pour l'événement d'ouverture de la modal
                $('#exampleModalCenter').on('show.bs.modal', function (event) {
                    var button = $(event.relatedTarget);
                    var videoUrl = button.data('url_video'); 
                    var video_Id = extractVideoId(videoUrl);

                    console.log(player);

                    if (!player) {
                        player = new YT.Player('player', {
                            height: '100%',
                            width: '100%',  
                            videoId: video_Id, 
                            playerVars: {
                                'controls': 0, // Désactive la barre de contrôle (lecture, pause, etc.)
                                'disablekb': 1, // Désactive les raccourcis clavier
                                'modestbranding': 1, // Réduit l'image de marque YouTube
                                'rel': 0, // Ne montre pas les vidéos suggérées à la fin
                                'showinfo': 0, // Masque les informations sur la vidéo (titre, uploader)
                                'fs': 0, // Désactive le bouton plein écran
                                'iv_load_policy': 3, // Désactive les annotations
                                'autohide': 1, // Masque les commandes après la lecture de la vidéo
                                'playsinline': 1, // Joue la vidéo en ligne au lieu de plein écran sur mobile
                                'enablejsapi': 1 // Active l'API JavaScript
                            },
                            events: {
                                'onReady': onPlayerReady,
                                'onError': function(event) {
                                    console.error("Erreur dans le lecteur:", event.data);
                                },
                                'onStateChange': onPlayerStateChange
                            }
                        });
                    } else {
                        player.loadVideoById(video_Id); // Change la vidéo et commence la lecture
                    }

                    console.log(player);

                    playerReadyDeferred.done(function() {
                        if (player && typeof player.cueVideoById === 'function') {
                            player.cueVideoById(video_Id);
                            console.log("Vidéo chargée avec ID:", video_Id);
                        } else {
                            console.error('La méthode cueVideoById n\'est pas disponible.');
                        }
                    }).fail(function() {
                        console.error("Le lecteur n'est pas prêt.");
                    });
                });

                // Fonction appelée lorsque le lecteur est prêt
                function onPlayerReady(event) {
                    var playButton = $('#playButton');
                    console.log("Le lecteur est prêt");

                    document.getElementById('progress-bar').addEventListener('input', seekVideo);

                    updatePlayButtonText();
                    updateDuration();

                    playButton.on('click', function() {
                        if (player && player.getPlayerState() === YT.PlayerState.PLAYING) {
                            player.pauseVideo(); 
                        } else if (player) {
                            player.playVideo(); 
                        }

                        updatePlayButtonText();
                    });

                    player.addEventListener('onStateChange', function(event) {
                        updatePlayButtonText();
                    });

                    function updatePlayButtonText() {
                        if (player && player.getPlayerState() === YT.PlayerState.PLAYING) {
                            playButton.text('Pause Video'); 
                        } else {
                            playButton.text('Play Video'); 
                        }
                    }
                }

                function onPlayerStateChange(event) {
                    if (event.data === YT.PlayerState.PLAYING) {
                        updateTime();
                    }
                }


                function updateTime() {
                    const currentTime = player.getCurrentTime();
                    const duration = player.getDuration();
                    document.getElementById('current-time').textContent = formatTime(currentTime);
                    document.getElementById('duration').textContent = formatTime(duration);

                    // Mettre à jour la barre de progression
                    document.getElementById('progress-bar').value = (currentTime / duration) * 100;

                    if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                        setTimeout(updateTime, 1000);
                    }
                }


                function seekVideo(event) {
                    const value = event.target.value;
                    const duration = player.getDuration();
                    player.seekTo(duration * (value / 100));
                }


                function updateDuration() {
                    const duration = player.getDuration();
                    document.getElementById('duration').textContent = formatTime(duration);
                }


                function formatTime(seconds) {
                    const minutes = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${pad(minutes)}:${pad(secs)}`;
                }

                function pad(number) {
                    return number < 10 ? '0' + number : number;
                }


                // Écouteur pour l'événement de fermeture de la modal
                $('#exampleModalCenter').on('hidden.bs.modal', function () {
                    if (player && typeof player.stopVideo === 'function') {
                        player.stopVideo(); 
                    }
                });


    </script>


</body>
</html>